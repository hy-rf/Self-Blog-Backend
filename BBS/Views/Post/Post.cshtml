@using BBS.Models;
@model Post;
@using System.Security.Claims;



@if (User.Identity!.IsAuthenticated && Model.UserId == Convert.ToInt32(User.FindFirst(ClaimTypes.Sid)?.Value))
{
    <button id="toggleEditPostBtn">edit</button>
    <div id="PostFormWrapper">
        <br />
        <p>Title</p>
        <input id="Title" />
        <div id="EditPostForm"></div>
        <input id="Tag" />
        <button id="submitEditPost">Submit</button>
    </div>
}
<div id="PostList">
    <div class="PostUnit">
        <p>@Model.Id</p>
        <p class="Title">@Model.Title</p>
        @if (User.Identity.IsAuthenticated)
        {
            if (Model.Likes!.Any(l => l.UserId == Convert.ToInt32(User.FindFirst(ClaimTypes.Sid)?.Value)))
            {
                <img src="~/img/heartfill.png" class="LikeBtn" width="16" height="16">
            }
            else
            {
                <img src="~/img/heartvac.png" class="LikeBtn" width="16" height="16">
            }
        }
        <div id="PostContent">
            @*@Html.Raw(Model.Content)*@
        </div>
        <div class="UserInfo">
            <p style="display: none;">@Model.UserId</p>
            <a href="/User/@Model.UserId">@Model.User!.Name</a>
            <img src="data:image/png;base64, @Model.User.Avatar" width="8" height="8">
        </div>
        <p class="timeIndicator">
            <span>Created:@Model.Created.ToString("hh:mm yy/MM/dd")</span>
            <span>Modified:@Model.Modified.ToString("hh:mm yy/MM/dd")</span>
        </p>
        <p id="Tags">
            @if (Model.PostTags != null)
            {

                @foreach (var item in Model.PostTags)
                {
                    <a asp-action="Index" asp-controller="Tag" asp-route-Id="@Convert.ToInt32(item.Tag.Id)">#@item.Tag.Name</a>
                }

            }
        </p>
    </div>
</div>
<div id="Replies">
    Replies
    @foreach (var item in Model.Replies!)
    {
        <div class="ReplyUnit">
            <p>@item.Content</p>
            <div class="UserInfo">
                <p>@item.User!.Id</p>
                <a href="/User/@item.User.Id">@item.User.Name</a>
                <img src="data:image/png;base64, @item.User.Avatar" width="8" height="8">
            </div>

            <p class="timeIndicator">
                <span>Created:@item.Created.ToString("hh:mm yy/MM/dd")</span>
                <span>Modified:@item.Modified.ToString("hh:mm yy/MM/dd")</span>
            </p>
        </div>
    }
</div>
@if (User.Identity.IsAuthenticated)
{
    <form asp-action="Reply" asp-controller="Reply" asp-route-PostId="@Model.Id">
        <input name="Content" placeholder="Content">
        <button type="submit">Reply</button>
    </form>
}

